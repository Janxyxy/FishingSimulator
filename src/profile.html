<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fishing simulator</title>
  <link href="/output.css" rel="stylesheet" />
  <!--Tailwind CSS-->
  <script src="https://kit.fontawesome.com/c4ffb2ea08.js" crossorigin="anonymous"></script>
  <!--Muj font awesome-->
</head>

<body
  class="bg-fixed bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-gray-700 via-gray-900 to-black text-white">
  <header class="bg-gray-800 p-4 shadow-lg">
    <div class="container mx-auto flex justify-between m-2">
      <blockquote class="text-2xl font-semibold text-white">
        <!--text-->
        <span
          class="before:block before:absolute before:-inset-1 before:-skew-y-2 before:bg-gradient-to-r from-purple-900 to-blue-500 relative inline-block">
          <span class="relative text-white">Profile</span>
        </span>
        <i class="fa-solid fa-user ml-2"></i>
        <!--text-->
      </blockquote>
      <nav>
        <ul class="flex space-x-12 mt-1 mr-10">
          <li>
            <a href="/home" class="hover:text-blue-500">Home <i class="fa-solid fa-house"></i></a>
          </li>
          <li>
            <a href="/register" class="hover:text-blue-500">Sing up
              <i class="fas fa-user-plus ml-2"></i>
            </a>
          </li>
          <li>
            <a href="/login" class="hover:text-blue-500">Login <i class="fa-solid fa-right-to-bracket ml-2"></i></a>
          </li>
          <li>
            <a href="/mainpage" class="hover:text-blue-500">Fishing simulator
              <i class="fa-solid fa-fish"></i>
            </a>
          </li>
          <li>
            <a href="/profile" class="hover:text-blue-500">Profile
              <i class="fa-solid fa-user"></i>
            </a>
          </li>
        </ul>
      </nav>
  </header>
  <div>
    <div class="flex flex-col items-center mt-8">
     
        <span id="username" class="text-3xl font-bold text-white mb-4"></span>
        <span id="userId" class="text-lg text-white mb-2"></span>
    
      
      <span id="creation_date" class="text-lg text-white"></span>
      <span id="last_update_time" class="text-lg text-white"></span>

      <button onclick="showDeletePopup();" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mt-4">Delete profile</button>
    </div>
    <h1 class="text-center text-white text-2xl mt-4">Jirkoooo udelej csska d√≠ky</h1>
  </div>
  </div>
  <div
      id="deletePopup"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 "
    >
      <div class="bg-white p-4 rounded-lg shadow-lg text-center">
        <h2 class="text-2xl font-bold mb-4 text-black">
         Delte! Delete! Delete!
        </h2>
        <p class="mb-4 text-black">
          This action is irreversible and all your data will be lost.
        </p>
        <div class="flex justify-center">
          <img src="/public/images/deleteuser.png" class="w-96 rounded-lg" />
        </div>
        <div class=" mt-4 flex justify-center gap-6">
          <button
          id="loginButton"
          onclick="event.preventDefault(); DeleteUser();"
          class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
        >
          Yes, I am sigma
        </button>
        <button
        id="loginButton"
        onclick="hideDeletePopup();"
        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
      >
        No, I not sigma
      </button>
        </div>
        
      </div>
    </div>

  <script>
    
    document.addEventListener("DOMContentLoaded", function () {
      fetchData();
    });

    const popup = document.getElementById("deletePopup");

    function showDeletePopup() {
      popup.classList.remove("invisible");
    }

    function hideDeletePopup() {
      popup.classList.add("invisible");
    }

    function DeleteUser(){
      fetch("/api/delete", {
        method: "DELETE",
      })
      .then((response) => {
        if (response.ok) {
          window.location.href = "/home";
        } else {
          throw new Error("Failed to delete user");
        }
      })
      .catch((error) => {
        console.error("Error deleting user:", error);
      });	
    }

    async function fetchData() {
      try {
        const username = await getName();
        const userId = await getId();
        const creation_date = await getCreationDate();
        const lastUpdateTime = await getLastUpdateTime();

        formatted_creation_date = await formatCreationDate(creation_date);
        formated_lastUpdateTime = await formatCreationDate(lastUpdateTime);
       
        displayData(username, userId, formatted_creation_date, formated_lastUpdateTime);

        console.log(username + " " + userId + " " + formatted_creation_date + " " + formated_lastUpdateTime)
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    async function formatCreationDate(time) {
      const creationDate = new Date(time);

      const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hourCycle: 'h24'
      };

      const formattedDate = creationDate.toLocaleDateString('cs-CZ', options);
      return formattedDate;
    }

    async function getId() {
      const response = await fetch("/api/userId");
      if (response.ok) {
        const data = await response.json();
        return data.userId;
      } else {
        throw new Error("Failed to fetch user ID");
      }
    }

    async function getName() {
      const response = await fetch("/api/username");
      if (response.ok) {
        const data = await response.json();
        return data.username;
      } else {
        throw new Error("Failed to fetch username");
      }
    }

    async function getCreationDate() {
      const response = await fetch("/api/creation_date");
      if (response.ok) {
        const data = await response.json();
        return data[0].creation_date;
      } else {
        throw new Error("Failed to fetch creation date");
      }
    }

    async function getLastUpdateTime() {
      const response = await fetch("/api/last_update_time");
      if (response.ok) {
        const data = await response.json();
        return data[0].last_update_time;
      } else {
        throw new Error("Failed to fetch creation date");
      }
    }

    function displayData(username, userId, creation_date, last_update_time) {
      const username_p = document.getElementById("username");
      const userId_p = document.getElementById("userId");
      const creation_date_p = document.getElementById("creation_date");
      const last_update_time_p = document.getElementById("last_update_time");

      username_p.textContent = "Username: " + username;
      userId_p.textContent = "User ID: " + userId;
      creation_date_p.textContent = "Creation date: " + creation_date;
      last_update_time_p.textContent = "Last update time: " + last_update_time;
    }
  </script>
</body>

</html>